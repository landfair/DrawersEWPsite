<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drawers - Resource Organization</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
    /* Brand Colors - Purple Palette */
    --primary-color: #6b2d8f;
    --primary-dark: #4a1d65;
    --primary-light: #8e44ad;
    --primary-gradient: linear-gradient(135deg, #7b3fa0 0%, #5a2278 100%);

    /* Neutral Colors */
    --text-primary: #2d2d3a;
    --text-secondary: #5a5a6e;
    --text-tertiary: #8a8a9e;
    --background-color: #f5f3f8;
    --card-background: #ffffff;
    --header-background: #ffffff;
    --modal-background: #ffffff;
    --input-background: #ffffff;

    /* Accent Colors - Purple Tints */
    --accent-purple-light: #a47bb8;
    --accent-purple-lighter: #d4c4e0;
    --accent-purple-lightest: #ebe5f2;

    /* UI Elements */
    --border-color: #e4e0eb;
    --border-color-strong: #c8c0d6;
    --card-border: 1px solid rgba(230, 225, 240, 0.8);

    /* Spacing Scale */
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;
    --space-2xl: 48px;

    /* Border Radius */
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 14px;
    --radius-xl: 20px;
    --radius-full: 9999px;

    /* Shadows */
    --shadow-sm: 0 2px 8px rgba(87, 6, 140, 0.08);
    --shadow-md: 0 4px 16px rgba(87, 6, 140, 0.12);
    --shadow-lg: 0 8px 24px rgba(87, 6, 140, 0.16);
    --shadow-xl: 0 16px 48px rgba(87, 6, 140, 0.2);

    /* Transitions */
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  margin: 0;
  padding: 0;
  background-color: var(--background-color);
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  min-height: 100vh;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px var(--space-sm);
  background-color: var(--header-background);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  position: sticky;
  top: 0;
  z-index: 100;
}

.logo-container {
  height: 32px;
  display: flex;
  align-items: center;
  flex-shrink: 0;
}

.logo-container img {
  height: 100%;
  max-width: 140px;
  object-fit: contain;
}

.header-back-btn {
  margin-right: 6px;
  flex-shrink: 0;
}

.header-title {
  flex-grow: 1;
  min-width: 0;
  text-align: center;
}

.header-title h1,
.header-title h2 {
  font-size: 1.1rem;
  background: var(--primary-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin: 0;
  font-weight: 700;
  letter-spacing: -0.03em;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.header-buttons {
  display: flex;
  gap: 6px;
  align-items: center;
  flex-shrink: 0;
}

.options-dropdown {
  position: relative;
  display: inline-block;
}

.toggle-btn {
  background: transparent;
  color: var(--primary-color);
  border: none;
  border-radius: var(--radius-sm);
  padding: 4px 8px;
  font-size: 1.2rem;
  font-weight: 300;
  cursor: pointer;
  transition: all var(--transition-fast);
  line-height: 1;
}

.toggle-btn:hover {
  background-color: var(--accent-purple-lightest);
  transform: scale(1.1);
}

.options-dropdown-menu {
  display: none;
  position: absolute;
  right: 0;
  top: calc(100% + 5px);
  background-color: var(--card-background);
  min-width: 200px;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  border-radius: var(--radius-md);
  z-index: 1000;
  border: 1px solid var(--border-color);
  overflow: hidden;
}

.options-dropdown-menu.show {
  display: block;
  animation: dropdownFadeIn 0.2s ease-out;
}

@keyframes dropdownFadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dropdown-item {
  display: block;
  width: 100%;
  padding: 12px 20px;
  text-align: left;
  background: none;
  border: none;
  border-bottom: 1px solid var(--border-color);
  color: var(--text-primary);
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-base);
}

.dropdown-item:last-child {
  border-bottom: none;
}

.dropdown-item:hover {
  background-color: var(--accent-purple-lightest);
  color: var(--primary-color);
}

.container {
  max-width: 100%;
  margin: 0 auto;
  padding: var(--space-md) var(--space-sm) 60px;
}

.overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  backdrop-filter: blur(4px);
}

.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #ffffff;
  border-radius: 16px;
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
  z-index: 1000;
  width: 90%;
  max-width: 450px;
  max-height: 85vh;
  display: none;
  flex-direction: column;
  animation: modalFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  overflow: hidden;
}

@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: translate(-50%, -48%) scale(0.96);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.popup[style*="display: block"] {
  display: flex;
}

.popup-header {
  padding: 20px 24px 16px;
  border-bottom: 1px solid #f0f0f0;
  flex-shrink: 0;
}

.popup-header h2 {
  margin: 0;
  font-size: 1.2rem;
  color: #0a0a0a;
  text-align: left;
  font-weight: 600;
}

.popup-body {
  padding: 16px 24px 12px;
  overflow-y: auto;
  flex: 1 1 auto;
  min-height: 0;
  max-height: calc(85vh - 180px);
}

.popup-body label {
  display: block;
  font-size: 0.8125rem;
  font-weight: 600;
  color: #2a2a2a;
  margin-bottom: 6px;
  text-align: left;
}

.popup input[type="text"],
.popup input[type="url"] {
  font-size: 0.9375rem;
  padding: 13px 16px;
  width: 100%;
  border: 1px solid #d8d8d8;
  border-radius: 10px;
  background-color: #fafafa;
  transition: all 0.2s;
  box-sizing: border-box;
  margin-bottom: 12px;
}

.popup input:focus {
  outline: none;
  background-color: #ffffff;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(107, 45, 143, 0.08);
}

.popup textarea {
  width: 100%;
  min-height: 70px;
  resize: vertical;
  padding: 10px 14px;
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
  border: 1px solid #d8d8d8;
  border-radius: 10px;
  background-color: #fafafa;
  margin-bottom: 12px;
}

.popup textarea:focus {
  outline: none;
  background-color: #ffffff;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(107, 45, 143, 0.08);
}

.popup-buttons {
  padding: 14px 24px 20px;
  border-top: 1px solid #f0f0f0;
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  flex-shrink: 0;
}

.popup-buttons button {
  font-size: 0.875rem;
  padding: 11px 20px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
  white-space: nowrap;
}

.popup-buttons button:first-child {
  background: var(--primary-color);
  color: white;
  box-shadow: 0 1px 3px rgba(107, 45, 143, 0.12);
}

.popup-buttons button:first-child:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(107, 45, 143, 0.2);
}

.popup-buttons button:last-child {
  background: #f5f5f5;
  color: #3a3a3a;
  border: 1px solid #e5e5e5;
}

.popup-buttons button:last-child:hover {
  background-color: #ebebeb;
}

#landing-container {
  margin: 0 auto;
  padding: var(--space-md) 0;
}

.drawer-search-container {
  display: flex;
  justify-content: center;
  padding: 0 var(--space-md);
  margin-bottom: var(--space-md);
}

.search-input-wrapper {
  position: relative;
  width: 100%;
  max-width: 500px;
}

.drawer-search-input {
  width: 100%;
  padding: 8px 36px 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 0.9rem;
  background: var(--input-background);
  transition: all var(--transition-fast);
  box-sizing: border-box;
}

.drawer-search-input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 2px rgba(107, 45, 143, 0.1);
}

.search-clear-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  color: var(--text-tertiary);
  font-size: 1.5rem;
  cursor: pointer;
  border-radius: 50%;
  transition: all var(--transition-fast);
}

.search-clear-btn:hover {
  background: var(--border-color);
  color: var(--text-primary);
}

.comment-banks {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: var(--space-md);
}

.add-comment-bank {
  display: flex;
  justify-content: center;
}

.add-comment-bank .add-button {
  font-size: 1rem;
  padding: 10px 20px;
  background: var(--primary-gradient);
  color: white;
  border: none;
  border-radius: var(--radius-full);
  cursor: pointer;
  font-weight: 600;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-base);
  width: 100%;
}

.add-comment-bank .add-button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.comment-bank-link {
  display: flex;
  flex-direction: column;
  padding: 14px 16px;
  background-color: var(--card-background);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: all var(--transition-base);
  border: var(--card-border);
  position: relative;
}

.comment-bank-link:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.comment-bank-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.comment-bank-name {
  font-size: 0.95rem;
  font-weight: 500;
}

.drawer-card-count {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  padding: 3px 8px;
  background: var(--background-color);
  border-radius: var(--radius-sm);
  margin-left: 6px;
}

.comment-bank-actions {
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.comment-bank-link:hover .comment-bank-actions {
  opacity: 1;
}

.bank-action-btn {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 0.75rem;
  transition: all var(--transition-fast);
  font-weight: 500;
}

.bank-action-btn:hover {
  background: var(--accent-purple-lightest);
  color: var(--primary-color);
  border-color: var(--primary-color);
}

.bank-archive-btn:hover {
  background: #f0f4ff;
  color: #4a90e2;
  border-color: #4a90e2;
}

.no-comment-banks {
  text-align: center;
  font-style: italic;
  color: var(--text-tertiary);
  margin-top: 40px;
}

.comment-container {
  display: none;
  margin: 0;
  padding: 0;
}

.comment-header-wrapper {
  position: sticky;
  top: 48px;
  z-index: 90;
  background: var(--header-background);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.comment-actions {
  display: flex;
  align-items: center;
  padding: 8px 4px;
  background: var(--header-background);
  border-bottom: 1px solid var(--border-color);
  gap: 4px;
}

.comment-search-wrapper {
  position: relative;
  flex: 1;
  min-width: 80px;
}

.comment-search-input {
  width: 100%;
  padding: 6px 32px 6px 10px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 0.85rem;
  background: var(--input-background);
  box-sizing: border-box;
}

.comment-search-input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 2px rgba(107, 45, 143, 0.1);
}

.comment-actions button {
  background: var(--accent-purple-lightest);
  color: var(--primary-color);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  padding: 8px 12px;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  width: 44px;
  min-width: 44px;
}

.comment-actions #addCommentBtn {
  background: var(--primary-gradient);
  color: white;
  font-weight: 700;
  font-size: 1.4rem;
}

.comment-actions button:hover {
  transform: translateY(-1px);
}

.tag-filter-bar {
  padding: 0;
  background: var(--header-background);
  border-bottom: 2px solid var(--border-color);
}

.tag-filter-header {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  padding: 6px var(--space-sm);
  background: var(--accent-purple-lightest);
  border-bottom: 1px solid var(--border-color);
}

.toggle-filters-btn {
  background: transparent;
  border: none;
  font-size: 1rem;
  padding: 2px 6px;
  cursor: pointer;
  color: var(--primary-color);
  transition: transform var(--transition-fast);
}

.toggle-filters-btn:hover {
  background: var(--accent-purple-lighter);
  border-radius: var(--radius-sm);
}

.tag-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  padding: 6px 4px;
  max-height: 200px;
  overflow-y: auto;
  transition: max-height var(--transition-base);
}

.tag-filters.hidden {
  max-height: 0;
  padding: 0;
  overflow: hidden;
}

.tag-filter {
  cursor: pointer;
  padding: 3px 8px;
  border-radius: var(--radius-full);
  font-size: 0.65rem;
  font-weight: 600;
  border: 2px solid;
  transition: all var(--transition-fast);
  opacity: 0.7;
}

.tag-filter:hover {
  opacity: 1;
  transform: translateY(-1px);
}

.tag-filter.active {
  opacity: 1;
  box-shadow: var(--shadow-sm);
  transform: scale(1.03);
}

.tag-filter.active::after {
  content: '‚úì';
  margin-left: 4px;
}

.filter-count {
  font-size: 0.7rem;
  color: var(--text-secondary);
  flex: 1;
}

.clear-filters-btn {
  padding: 4px 10px;
  background: var(--text-tertiary);
  color: white;
  border: none;
  border-radius: var(--radius-full);
  font-size: 0.7rem;
  font-weight: 600;
  cursor: pointer;
  margin-left: auto;
}

.clear-filters-btn:hover {
  background: var(--text-secondary);
}

.comments-list-wrapper {
  padding: var(--space-sm) 6px;
}

.comment {
  position: relative;
  border: var(--card-border);
  padding: 0;
  margin-bottom: var(--space-sm);
  border-radius: var(--radius-md);
  background-color: var(--card-background);
  transition: all var(--transition-base);
  box-shadow: 0 2px 8px rgba(107, 45, 143, 0.06);
}

.comment:hover {
  box-shadow: 0 6px 20px rgba(107, 45, 143, 0.12);
  transform: translateY(-2px);
}

.comment::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: var(--primary-color);
  transition: width var(--transition-base);
}

.comment:hover::before {
  width: 6px;
}

.comment-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  background: var(--accent-purple-lightest);
  border-bottom: 1px solid var(--border-color);
  border-radius: var(--radius-md) var(--radius-md) 0 0;
}

.comment-checkbox {
  width: 16px;
  height: 16px;
  cursor: pointer;
  accent-color: var(--primary-color);
}

.tags-container {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  align-items: center;
  flex: 1;
}

.tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: var(--radius-full);
  font-size: 0.65rem;
  font-weight: 600;
  border: 2px solid;
}

.comment-body {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.card-title-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-title-display {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  flex: 1;
}

.card-title-link {
  color: var(--primary-color);
  text-decoration: none;
  transition: color var(--transition-fast);
}

.card-title-link:hover {
  color: #8e44ad;
  text-decoration: underline;
}

.copy-link-btn {
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-tertiary);
  font-size: 0.85rem;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.copy-link-btn:hover {
  background: var(--accent-purple-lightest);
  border-color: var(--primary-color);
  color: var(--primary-color);
}

.card-description-wrapper {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.card-description-display {
  font-size: 0.85rem;
  line-height: 1.5;
  color: var(--text-secondary);
  white-space: pre-wrap;
  word-wrap: break-word;
}

.card-description-display.collapsed {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.description-toggle {
  align-self: flex-start;
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--primary-color);
  font-size: 0.75rem;
  padding: 2px 8px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-weight: 500;
}

.description-toggle:hover {
  background: var(--accent-purple-lightest);
}

.comment-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 8px;
  background: rgba(107, 45, 143, 0.02);
  border-top: 1px solid var(--border-color);
  border-radius: 0 0 var(--radius-md) var(--radius-md);
}

.comment-actions-inline {
  display: flex;
  gap: 3px;
}

.comment-actions-inline button {
  padding: 3px 8px;
  font-size: 0.7rem;
  border-radius: var(--radius-sm);
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-secondary);
  cursor: pointer;
  font-weight: 500;
}

.comment-actions-inline button:hover {
  background: var(--card-background);
  border-color: var(--border-color);
  color: var(--primary-color);
}

.btn-icon-compact {
  background: transparent;
  color: var(--text-secondary);
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 1.2rem;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.btn-icon-compact:hover {
  background: var(--accent-purple-lightest);
  color: var(--primary-color);
}

.tag-manager {
  max-width: 500px;
}

.tag-list {
  margin: 0 0 16px;
  max-height: 180px;
  overflow-y: auto;
  border: 1px solid #d8d8d8;
  border-radius: 10px;
  background: #fafafa;
}

.tag-list-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  border-bottom: 1px solid #e8e8e8;
  background: white;
}

.tag-list-item:last-child {
  border-bottom: none;
}

.tag-list-actions {
  display: flex;
  gap: 6px;
}

.tag-list-actions button {
  padding: 6px 12px;
  font-size: 0.8rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
}

.tag-form {
  padding: 16px;
  border: 1px solid #d8d8d8;
  border-radius: 10px;
  background: #fafafa;
}

.tag-form-row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.tag-form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
  flex: 1;
}

.tag-color-group {
  max-width: 90px;
  flex: 0;
}

.tag-form-group input[type="text"] {
  padding: 11px 14px;
  border: 1px solid #d8d8d8;
  border-radius: 8px;
  font-size: 0.875rem;
  background: white;
}

.tag-form-group input[type="color"] {
  height: 42px;
  cursor: pointer;
  border: 1px solid #d8d8d8;
  border-radius: 8px;
  padding: 4px;
  background: white;
}

.btn-primary {
  width: 100%;
  padding: 10px;
  background: var(--primary-gradient);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: var(--shadow-sm);
}

.btn-primary:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.modal-tags-section {
  margin-top: 8px;
}

.modal-tags-container {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  padding: 10px;
  border: 1px solid #d8d8d8;
  border-radius: 10px;
  background: #fafafa;
  min-height: 44px;
  max-height: 100px;
  overflow-y: auto;
}

.modal-tag {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 12px;
  border-radius: 7px;
  font-size: 0.75rem;
  font-weight: 500;
  border: 2px solid;
  cursor: pointer;
  transition: all 0.2s;
  opacity: 0.5;
}

.modal-tag:hover {
  opacity: 0.75;
  transform: translateY(-1px);
}

.modal-tag.selected {
  opacity: 1;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transform: scale(1.02);
  font-weight: 600;
}

.modal-tag.selected::before {
  content: '‚úì';
  font-weight: 700;
}

.no-tags-message {
  font-size: 0.8125rem;
  color: #a0a0a0;
  font-weight: 500;
}

.about-modal {
  max-width: 600px;
  max-height: 90vh;
}

.about-section {
  margin-bottom: 32px;
}

.about-heading {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--primary-color);
  margin: 0 0 12px 0;
}

.about-text {
  color: var(--text-primary);
  line-height: 1.6;
  margin: 0 0 12px 0;
  font-size: 0.9rem;
}

.about-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.about-list li {
  padding: 10px 0 10px 24px;
  color: var(--text-primary);
  line-height: 1.6;
  font-size: 0.875rem;
  position: relative;
  border-left: 3px solid var(--accent-purple-lightest);
  margin-bottom: 8px;
  background: var(--background-color);
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  padding-right: 12px;
}

.about-list li:before {
  content: "‚Üí";
  position: absolute;
  left: 8px;
  color: var(--primary-color);
  font-weight: bold;
}

.about-list li strong {
  color: var(--primary-color);
  font-weight: 600;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.feature-item {
  display: flex;
  gap: 12px;
  padding: 16px;
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  transition: all 0.2s;
}

.feature-item:hover {
  background: var(--accent-purple-lightest);
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

.feature-icon {
  font-size: 2rem;
  line-height: 1;
}

.feature-content {
  flex: 1;
}

.feature-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 6px 0;
}

.feature-desc {
  font-size: 0.8rem;
  color: var(--text-secondary);
  line-height: 1.5;
  margin: 0;
}

.about-footer {
  text-align: center;
  padding-top: 24px;
  border-top: 2px solid var(--border-color);
}

.about-version {
  font-size: 0.85rem;
  color: var(--text-tertiary);
  margin: 0 0 8px 0;
}

.about-tagline {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin: 0;
  font-style: italic;
}

.empty-state {
  text-align: center;
  padding: var(--space-2xl) var(--space-xl);
  color: var(--text-tertiary);
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: var(--space-lg);
  opacity: 0.5;
}

.empty-state h3 {
  color: var(--text-secondary);
  margin-bottom: var(--space-sm);
}

.drawer-search-results {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border-color);
}

.search-result-count {
  font-size: 0.75rem;
  color: var(--primary-color);
  font-weight: 600;
  background: var(--accent-purple-lightest);
  padding: 3px 8px;
  border-radius: var(--radius-sm);
  display: inline-block;
  margin-bottom: 6px;
}

.search-results-preview {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.search-result-card-preview {
  font-size: 0.8rem;
  color: var(--text-secondary);
  padding: 4px 8px;
  background: var(--background-color);
  border-radius: var(--radius-sm);
  border-left: 2px solid var(--primary-color);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: all 0.2s;
  cursor: pointer;
}

.search-result-card-preview:hover {
  background: var(--accent-purple-lightest);
  transform: translateX(2px);
  color: var(--text-primary);
}

.search-highlight {
  background-color: rgba(107, 45, 143, 0.2);
  border-radius: 2px;
  padding: 1px 2px;
  font-weight: 600;
}
  </style>
</head>
<body>
  <header class="header">
    <div class="logo-container">
      <img src="https://i.imgur.com/iIODsNl.png" alt="Logo" class="logo-img" id="headerLogo">
    </div>
    <button class="btn-icon-compact header-back-btn" id="backToHomeBtn" title="Back to Home" style="display: none;">‚Üê</button>
    <div class="header-title">
      <h1 id="main-title">Drawers</h1>
      <h2 id="assignment-heading" style="display: none;"></h2>
    </div>
    <div class="header-buttons">
      <div class="options-dropdown">
        <button class="toggle-btn" id="optionsDropdownBtn" title="Options">‚à®</button>
        <div class="options-dropdown-menu" id="optionsDropdownMenu">
          <button class="dropdown-item" id="aboutBtn">About</button>
          <button class="dropdown-item" id="uploadBtn">Upload Drawer</button>
          <button class="dropdown-item" id="downloadBtn">Download Drawer</button>
          <button class="dropdown-item" id="resetBtn">Reset All Data</button>
        </div>
      </div>
    </div>
  </header>

  <div id="overlay" class="overlay"></div>

  <div class="container">
    <!-- About Popup -->
    <div id="about-popup" class="popup about-modal">
      <div class="popup-header">
        <h2>About Drawers</h2>
      </div>
      <div class="popup-body">
        <div class="about-section">
          <h3 class="about-heading">The Problem with Traditional Bookmarks</h3>
          <p class="about-text">
            Browser bookmarks were designed for casual web browsing, not professional knowledge management. They fall short in several critical ways:
          </p>
          <ul class="about-list">
            <li><strong>Chaotic Organization:</strong> Bookmarks pile up in folders with no clear structure.</li>
            <li><strong>No Context:</strong> You can't add descriptions or explanations about why a resource matters.</li>
            <li><strong>No Tagging or Filtering:</strong> You're stuck with rigid folder hierarchies.</li>
          </ul>
        </div>

        <div class="about-section">
          <h3 class="about-heading">How Drawers Solves This</h3>
          <p class="about-text">
            Drawers reimagines bookmarking as a <strong>contextual knowledge management system</strong> designed for educators and professionals.
          </p>

          <div class="feature-grid">
            <div class="feature-item">
              <div class="feature-icon">üóÇÔ∏è</div>
              <div class="feature-content">
                <h4 class="feature-title">Organized Drawers</h4>
                <p class="feature-desc">Group resources by project, course, or topic.</p>
              </div>
            </div>

            <div class="feature-item">
              <div class="feature-icon">üìù</div>
              <div class="feature-content">
                <h4 class="feature-title">Rich Context</h4>
                <p class="feature-desc">Add titles, descriptions, and links to each card.</p>
              </div>
            </div>

            <div class="feature-item">
              <div class="feature-icon">üè∑Ô∏è</div>
              <div class="feature-content">
                <h4 class="feature-title">Flexible Tagging</h4>
                <p class="feature-desc">Create custom tags and apply multiple tags to each card.</p>
              </div>
            </div>

            <div class="feature-item">
              <div class="feature-icon">üîç</div>
              <div class="feature-content">
                <h4 class="feature-title">Powerful Search</h4>
                <p class="feature-desc">Search across all drawers and cards instantly.</p>
              </div>
            </div>

            <div class="feature-item">
              <div class="feature-icon">üì§</div>
              <div class="feature-content">
                <h4 class="feature-title">Easy Sharing</h4>
                <p class="feature-desc">Export drawers as .drawer files.</p>
              </div>
            </div>

            <div class="feature-item">
              <div class="feature-icon">üíæ</div>
              <div class="feature-content">
                <h4 class="feature-title">Local Storage</h4>
                <p class="feature-desc">All data stored locally in your browser.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="about-section about-footer">
          <p class="about-version">Version 1.0</p>
          <p class="about-tagline">Built for educators, researchers, and knowledge workers who deserve better than browser bookmarks.</p>
        </div>
      </div>
      <div class="popup-buttons">
        <button id="closeAboutBtn">Close</button>
      </div>
    </div>

    <!-- New Drawer Popup -->
    <div id="popup" class="popup">
      <div class="popup-header">
        <h2>New Drawer</h2>
      </div>
      <div class="popup-body">
        <label for="assignment-name">Drawer Name</label>
        <input type="text" id="assignment-name" placeholder="e.g., Faculty Resources">
      </div>
      <div class="popup-buttons">
        <button id="createBankBtn">Create</button>
        <button id="cancelBankBtn">Cancel</button>
      </div>
    </div>

    <!-- Reset Confirmation Popup -->
    <div id="clear-data-popup" class="popup">
      <div class="popup-header">
        <h2>Are you sure you want to erase your data?</h2>
      </div>
      <div class="popup-buttons">
        <button id="yesClearBtn">Yes, let's erase it all!</button>
        <button id="noClearBtn">No, never mind.</button>
      </div>
    </div>

    <!-- Download Popup -->
    <div id="download-popup" class="popup">
      <div class="popup-header">
        <h2>Download Drawer</h2>
      </div>
      <div class="popup-body">
        <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 16px;">
          Select a drawer to download as a JSON file.
        </p>
        <div id="download-options"></div>
      </div>
      <div class="popup-buttons">
        <button id="downloadConfirmBtn">Download</button>
        <button id="cancelDownloadBtn">Cancel</button>
      </div>
    </div>

    <!-- Upload Popup -->
    <div id="upload-popup" class="popup">
      <div class="popup-header">
        <h2>Upload Drawer</h2>
      </div>
      <div class="popup-body">
        <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 16px;">
          Select a .drawer (JSON) file to upload.
        </p>
        <input type="file" id="upload-input" accept=".drawer,.json">
      </div>
      <div class="popup-buttons">
        <button id="uploadConfirmBtn">Upload</button>
        <button id="cancelUploadBtn">Cancel</button>
      </div>
    </div>

    <!-- Tag Manager Popup -->
    <div id="tag-manager-popup" class="popup tag-manager">
      <div class="popup-header">
        <h2>Manage Tags</h2>
      </div>
      <div class="popup-body">
        <p style="color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 12px;">
          Create custom tags to organize your cards. You can apply multiple tags to each card.
        </p>

        <div class="tag-list" id="tag-list"></div>

        <div class="tag-form">
          <div class="tag-form-row">
            <div class="tag-form-group">
              <label>Tag Name</label>
              <input type="text" id="new-tag-name" placeholder="e.g., Important, To Read">
            </div>
            <div class="tag-form-group tag-color-group">
              <label>Color</label>
              <input type="color" id="new-tag-color" value="#6b2d8f">
            </div>
          </div>
          <button class="btn-primary" id="addTagBtn">+ Add Tag</button>
        </div>
      </div>

      <div class="popup-buttons">
        <button id="doneTagsBtn">Done</button>
      </div>
    </div>

    <!-- Add/Edit Card Popup -->
    <div id="add-comment-popup" class="popup add-comment-modal">
      <div class="popup-header">
        <h2 id="comment-modal-title">New Card</h2>
      </div>
      <div class="popup-body">
        <label for="card-title">Title</label>
        <input type="text" id="card-title" placeholder="Enter card title...">

        <label for="card-link">Link</label>
        <input type="url" id="card-link" placeholder="Enter URL...">

        <label for="card-description">Description</label>
        <textarea id="card-description" placeholder="Enter card description..."></textarea>

        <div class="modal-tags-section">
          <label>Tags (optional)</label>
          <div class="modal-tags-container" id="modal-tags-container">
            <span class="no-tags-message">No tags available</span>
          </div>
        </div>
      </div>
      <div class="popup-buttons">
        <button id="saveCommentBtn">Save Card</button>
        <button id="cancelCommentBtn">Cancel</button>
      </div>
    </div>

    <!-- Landing Container -->
    <div id="landing-container">
      <div class="drawer-search-container">
        <div class="search-input-wrapper">
          <input type="text" id="drawer-search" class="drawer-search-input" placeholder="Search drawers and cards...">
          <button class="search-clear-btn" id="drawer-search-clear" style="display: none;" title="Clear search">√ó</button>
        </div>
      </div>

      <div id="comment-bank-list" class="comment-banks">
        <div class="add-comment-bank">
          <button class="add-button" id="addCommentBankBtn">+ Add Drawer</button>
        </div>
      </div>
      <p class="no-comment-banks" id="no-comment-banks-message">No drawers created yet.</p>
    </div>
  </div>

  <!-- Comment Container -->
  <div id="comment-container" class="comment-container">
    <div class="comment-header-wrapper">
      <div class="comment-actions">
        <div class="comment-search-wrapper">
          <input type="text" id="comment-search" class="comment-search-input" placeholder="Search cards...">
          <button class="search-clear-btn" id="comment-search-clear" style="display: none;" title="Clear search">√ó</button>
        </div>
        <button class="btn-compact" id="manageTagsBtn" title="Manage Tags">üè∑Ô∏è</button>
        <button class="btn-compact" id="copySelectedBtn" title="Copy Selected">üìã</button>
        <button class="btn-compact btn-primary-compact" id="addCommentBtn" title="Add Card">+</button>
      </div>

      <div class="tag-filter-bar" id="tag-filter-bar">
        <div class="tag-filter-header">
          <button class="toggle-filters-btn" id="toggle-filters-btn" title="Toggle filters">‚ñº</button>
          <span class="filter-count" id="filter-count"></span>
          <button class="clear-filters-btn" id="clear-filters-btn" style="display: none;">Clear</button>
        </div>
        <div class="tag-filters" id="tag-filters"></div>
      </div>
    </div>

    <div class="comments-list-wrapper">
      <div id="comments-list"></div>
    </div>
  </div>

  <script>
    // State management
    let commentBanks = [];
    let currentCommentBankIndex = -1;
    let activeTagFilters = [];
    let selectedComments = new Set();
    let searchQuery = '';

    // Generate unique IDs
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    // Basic universal tags for new drawers
    function getBasicTags() {
      return [
        { id: generateId(), name: 'Important', color: '#e74c3c' },
        { id: generateId(), name: 'Starred', color: '#f39c12' },
        { id: generateId(), name: 'To Read', color: '#3498db' },
        { id: generateId(), name: 'Reference', color: '#9b59b6' }
      ];
    }

    // localStorage wrapper
    function saveData() {
      localStorage.setItem('drawersData', JSON.stringify(commentBanks));
    }

    function loadData() {
      const saved = localStorage.getItem('drawersData');
      if (saved) {
        commentBanks = JSON.parse(saved);
      } else {
        // Initialize with empty array
        commentBanks = [];
      }
      updateCommentBankList();
    }

    // Navigation
    function goToHome() {
      document.getElementById('comment-container').style.display = 'none';
      document.getElementById('landing-container').style.display = 'block';
      document.querySelector('.container').style.display = 'block';
      document.getElementById('main-title').style.display = 'block';
      document.getElementById('assignment-heading').style.display = 'none';
      document.querySelector('.header-back-btn').style.display = 'none';
      document.querySelector('.logo-container').style.display = 'flex';
      currentCommentBankIndex = -1;
      selectedComments.clear();
    }

    function openCommentBank(index) {
      currentCommentBankIndex = index;
      const bank = commentBanks[index];

      document.getElementById('landing-container').style.display = 'none';
      document.getElementById('comment-container').style.display = 'block';
      document.querySelector('.container').style.display = 'none';
      document.getElementById('main-title').style.display = 'none';
      document.getElementById('assignment-heading').textContent = bank.assignmentName;
      document.getElementById('assignment-heading').style.display = 'block';
      document.querySelector('.header-back-btn').style.display = 'block';
      document.querySelector('.logo-container').style.display = 'none';

      activeTagFilters = [];
      searchQuery = '';
      document.getElementById('comment-search').value = '';

      displayComments(bank.comments);
      displayTagFilters();
    }

    // Display functions
    function updateCommentBankList() {
      const list = document.getElementById('comment-bank-list');
      const addButton = list.querySelector('.add-comment-bank');
      const noMessage = document.getElementById('no-comment-banks-message');

      // Clear existing items except add button
      const items = list.querySelectorAll('.comment-bank-link');
      items.forEach(item => item.remove());

      if (commentBanks.length === 0) {
        noMessage.style.display = 'block';
      } else {
        noMessage.style.display = 'none';
      }

      commentBanks.forEach((bank, index) => {
        const bankEl = document.createElement('div');
        bankEl.className = 'comment-bank-link';

        const header = document.createElement('div');
        header.className = 'comment-bank-header';

        const nameContainer = document.createElement('div');
        nameContainer.className = 'comment-bank-name-container';
        nameContainer.style.flex = '1';
        nameContainer.style.cursor = 'pointer';
        nameContainer.onclick = () => openCommentBank(index);

        const name = document.createElement('div');
        name.className = 'comment-bank-name';
        name.textContent = bank.assignmentName;

        const count = document.createElement('span');
        count.className = 'drawer-card-count';
        count.textContent = bank.comments.length;

        nameContainer.appendChild(name);
        nameContainer.appendChild(count);

        const actions = document.createElement('div');
        actions.className = 'comment-bank-actions';

        const archiveBtn = document.createElement('button');
        archiveBtn.className = 'bank-action-btn bank-archive-btn';
        archiveBtn.textContent = 'üóë';
        archiveBtn.title = 'Delete drawer';
        archiveBtn.onclick = (e) => {
          e.stopPropagation();
          if (confirm(`Delete "${bank.assignmentName}"? This cannot be undone.`)) {
            commentBanks.splice(index, 1);
            saveData();
            updateCommentBankList();
          }
        };

        actions.appendChild(archiveBtn);
        header.appendChild(nameContainer);
        header.appendChild(actions);
        bankEl.appendChild(header);

        // Check for drawer search results
        const drawerSearch = document.getElementById('drawer-search').value.trim().toLowerCase();
        if (drawerSearch) {
          const results = bank.comments.filter(card => {
            const title = (card.title || '').toLowerCase();
            const desc = (card.description || '').toLowerCase();
            const link = (card.link || '').toLowerCase();
            return title.includes(drawerSearch) || desc.includes(drawerSearch) || link.includes(drawerSearch);
          });

          if (results.length > 0) {
            const resultsDiv = document.createElement('div');
            resultsDiv.className = 'drawer-search-results';

            const resultCount = document.createElement('div');
            resultCount.className = 'search-result-count';
            resultCount.textContent = `${results.length} match${results.length !== 1 ? 'es' : ''}`;
            resultsDiv.appendChild(resultCount);

            const preview = document.createElement('div');
            preview.className = 'search-results-preview';

            results.slice(0, 3).forEach((card, cardIndex) => {
              const cardPreview = document.createElement('div');
              cardPreview.className = 'search-result-card-preview';
              cardPreview.textContent = card.title || 'Untitled';
              cardPreview.onclick = (e) => {
                e.stopPropagation();
                openCommentBank(index);
              };
              preview.appendChild(cardPreview);
            });

            resultsDiv.appendChild(preview);
            bankEl.appendChild(resultsDiv);
          }
        }

        list.insertBefore(bankEl, addButton);
      });
    }

    function displayComments(comments) {
      const list = document.getElementById('comments-list');
      list.innerHTML = '';

      const bank = commentBanks[currentCommentBankIndex];
      if (!bank) return;

      let filtered = comments;

      // Apply tag filters
      if (activeTagFilters.length > 0) {
        filtered = filtered.filter(card => {
          if (!card.tags || card.tags.length === 0) return false;
          return activeTagFilters.every(filterId => card.tags.includes(filterId));
        });
      }

      // Apply search filter
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(card => {
          const title = (card.title || '').toLowerCase();
          const desc = (card.description || '').toLowerCase();
          const link = (card.link || '').toLowerCase();
          return title.includes(query) || desc.includes(query) || link.includes(query);
        });
      }

      if (filtered.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><h3>No cards found</h3><p>Try adjusting your filters or search query</p></div>';
        return;
      }

      filtered.forEach((card, originalIndex) => {
        // Find original index
        const realIndex = comments.indexOf(card);

        const cardEl = document.createElement('div');
        cardEl.className = 'comment';

        // Header
        const header = document.createElement('div');
        header.className = 'comment-header';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'comment-checkbox';
        checkbox.checked = selectedComments.has(realIndex);
        checkbox.onchange = () => {
          if (checkbox.checked) {
            selectedComments.add(realIndex);
          } else {
            selectedComments.delete(realIndex);
          }
        };
        header.appendChild(checkbox);

        const tagsContainer = document.createElement('div');
        tagsContainer.className = 'tags-container';

        if (card.tags && card.tags.length > 0) {
          card.tags.forEach(tagId => {
            const tagDef = bank.tags.find(t => t.id === tagId);
            if (tagDef) {
              const tag = document.createElement('span');
              tag.className = 'tag';
              tag.textContent = tagDef.name;
              tag.style.borderColor = tagDef.color;
              tag.style.color = tagDef.color;
              tag.style.backgroundColor = tagDef.color + '20';
              tagsContainer.appendChild(tag);
            }
          });
        }

        header.appendChild(tagsContainer);
        cardEl.appendChild(header);

        // Body
        const body = document.createElement('div');
        body.className = 'comment-body';

        const titleRow = document.createElement('div');
        titleRow.className = 'card-title-row';

        const titleDisplay = document.createElement('div');
        titleDisplay.className = 'card-title-display';

        if (card.link) {
          const link = document.createElement('a');
          link.href = card.link;
          link.target = '_blank';
          link.className = 'card-title-link';
          link.textContent = card.title || 'Untitled';
          titleDisplay.appendChild(link);
        } else {
          titleDisplay.textContent = card.title || 'Untitled';
        }

        titleRow.appendChild(titleDisplay);

        if (card.link) {
          const copyBtn = document.createElement('button');
          copyBtn.className = 'copy-link-btn';
          copyBtn.textContent = 'üîó';
          copyBtn.title = 'Copy link';
          copyBtn.onclick = () => {
            navigator.clipboard.writeText(card.link).then(() => {
              copyBtn.textContent = '‚úì';
              setTimeout(() => copyBtn.textContent = 'üîó', 1000);
            });
          };
          titleRow.appendChild(copyBtn);
        }

        body.appendChild(titleRow);

        if (card.description) {
          const descWrapper = document.createElement('div');
          descWrapper.className = 'card-description-wrapper';

          const desc = document.createElement('div');
          desc.className = 'card-description-display collapsed';
          desc.textContent = card.description;

          const toggle = document.createElement('button');
          toggle.className = 'description-toggle';
          toggle.textContent = 'Show more';
          toggle.onclick = () => {
            if (desc.classList.contains('collapsed')) {
              desc.classList.remove('collapsed');
              toggle.textContent = 'Show less';
            } else {
              desc.classList.add('collapsed');
              toggle.textContent = 'Show more';
            }
          };

          descWrapper.appendChild(desc);
          descWrapper.appendChild(toggle);
          body.appendChild(descWrapper);
        }

        cardEl.appendChild(body);

        // Footer
        const footer = document.createElement('div');
        footer.className = 'comment-footer';

        const actions = document.createElement('div');
        actions.className = 'comment-actions-inline';

        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => editComment(realIndex);

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => deleteComment(realIndex);

        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);
        footer.appendChild(actions);
        cardEl.appendChild(footer);

        list.appendChild(cardEl);
      });
    }

    function displayTagFilters() {
      const container = document.getElementById('tag-filters');
      const countSpan = document.getElementById('filter-count');
      const clearBtn = document.getElementById('clear-filters-btn');

      container.innerHTML = '';

      const bank = commentBanks[currentCommentBankIndex];
      if (!bank || !bank.tags || bank.tags.length === 0) {
        countSpan.textContent = 'No tags available';
        clearBtn.style.display = 'none';
        return;
      }

      countSpan.textContent = activeTagFilters.length > 0
        ? `${activeTagFilters.length} filter${activeTagFilters.length !== 1 ? 's' : ''} active`
        : 'Filter by tags';

      clearBtn.style.display = activeTagFilters.length > 0 ? 'block' : 'none';

      bank.tags.forEach(tag => {
        const filterEl = document.createElement('span');
        filterEl.className = 'tag-filter';
        filterEl.textContent = tag.name;
        filterEl.style.borderColor = tag.color;
        filterEl.style.color = tag.color;
        filterEl.style.backgroundColor = tag.color + '20';

        if (activeTagFilters.includes(tag.id)) {
          filterEl.classList.add('active');
        }

        filterEl.onclick = () => {
          if (activeTagFilters.includes(tag.id)) {
            activeTagFilters = activeTagFilters.filter(id => id !== tag.id);
          } else {
            activeTagFilters.push(tag.id);
          }
          displayTagFilters();
          displayComments(bank.comments);
        };

        container.appendChild(filterEl);
      });
    }

    // CRUD operations
    function addComment() {
      document.getElementById('card-title').value = '';
      document.getElementById('card-link').value = '';
      document.getElementById('card-description').value = '';
      document.getElementById('add-comment-popup').removeAttribute('data-index');
      document.getElementById('comment-modal-title').textContent = 'New Card';
      populateModalTags();
      showAddCommentPopup();
    }

    function editComment(index) {
      const bank = commentBanks[currentCommentBankIndex];
      const card = bank.comments[index];

      document.getElementById('card-title').value = card.title || '';
      document.getElementById('card-link').value = card.link || '';
      document.getElementById('card-description').value = card.description || '';
      document.getElementById('add-comment-popup').setAttribute('data-index', index);
      document.getElementById('comment-modal-title').textContent = 'Edit Card';
      populateModalTags(card.tags || []);
      showAddCommentPopup();
    }

    function deleteComment(index) {
      if (!confirm('Delete this card?')) return;

      const bank = commentBanks[currentCommentBankIndex];
      bank.comments.splice(index, 1);

      // Update selectedComments
      const newSelected = new Set();
      selectedComments.forEach(i => {
        if (i < index) newSelected.add(i);
        else if (i > index) newSelected.add(i - 1);
      });
      selectedComments = newSelected;

      saveData();
      displayComments(bank.comments);
    }

    function saveComment() {
      const title = document.getElementById('card-title').value.trim();
      const link = document.getElementById('card-link').value.trim();
      const description = document.getElementById('card-description').value.trim();

      if (!title) {
        alert('Please enter a title');
        return;
      }

      const bank = commentBanks[currentCommentBankIndex];
      const selectedTags = Array.from(document.querySelectorAll('.modal-tag.selected'))
        .map(el => el.dataset.tagId);

      const card = { title, link, description, tags: selectedTags };

      const indexAttr = document.getElementById('add-comment-popup').getAttribute('data-index');
      if (indexAttr !== null) {
        // Edit
        bank.comments[parseInt(indexAttr)] = card;
      } else {
        // New
        bank.comments.push(card);
      }

      saveData();
      displayComments(bank.comments);
      hideAddCommentPopup();
    }

    function populateModalTags(selectedTags = []) {
      const container = document.getElementById('modal-tags-container');
      container.innerHTML = '';

      const bank = commentBanks[currentCommentBankIndex];
      if (!bank || !bank.tags || bank.tags.length === 0) {
        container.innerHTML = '<span class="no-tags-message">No tags available</span>';
        return;
      }

      bank.tags.forEach(tag => {
        const tagEl = document.createElement('span');
        tagEl.className = 'modal-tag';
        tagEl.textContent = tag.name;
        tagEl.dataset.tagId = tag.id;
        tagEl.style.borderColor = tag.color;
        tagEl.style.color = tag.color;
        tagEl.style.backgroundColor = tag.color + '20';

        if (selectedTags.includes(tag.id)) {
          tagEl.classList.add('selected');
        }

        tagEl.onclick = () => {
          tagEl.classList.toggle('selected');
        };

        container.appendChild(tagEl);
      });
    }

    // Tag management
    function showTagManager() {
      const bank = commentBanks[currentCommentBankIndex];
      if (!bank) return;

      displayTagList();
      document.getElementById('tag-manager-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function displayTagList() {
      const list = document.getElementById('tag-list');
      list.innerHTML = '';

      const bank = commentBanks[currentCommentBankIndex];
      if (!bank.tags || bank.tags.length === 0) {
        list.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">No tags created yet</div>';
        return;
      }

      bank.tags.forEach((tag, index) => {
        const item = document.createElement('div');
        item.className = 'tag-list-item';

        const tagSpan = document.createElement('span');
        tagSpan.className = 'tag';
        tagSpan.textContent = tag.name;
        tagSpan.style.borderColor = tag.color;
        tagSpan.style.color = tag.color;
        tagSpan.style.backgroundColor = tag.color + '20';

        const actions = document.createElement('div');
        actions.className = 'tag-list-actions';

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.style.background = '#fee';
        deleteBtn.style.color = '#c00';
        deleteBtn.onclick = () => {
          if (!confirm(`Delete tag "${tag.name}"?`)) return;
          bank.tags.splice(index, 1);
          // Remove from all cards
          bank.comments.forEach(card => {
            if (card.tags) {
              card.tags = card.tags.filter(id => id !== tag.id);
            }
          });
          saveData();
          displayTagList();
          displayTagFilters();
          displayComments(bank.comments);
        };

        actions.appendChild(deleteBtn);
        item.appendChild(tagSpan);
        item.appendChild(actions);
        list.appendChild(item);
      });
    }

    function addTag() {
      const name = document.getElementById('new-tag-name').value.trim();
      const color = document.getElementById('new-tag-color').value;

      if (!name) {
        alert('Please enter a tag name');
        return;
      }

      const bank = commentBanks[currentCommentBankIndex];
      if (!bank.tags) bank.tags = [];

      bank.tags.push({
        id: generateId(),
        name: name,
        color: color
      });

      saveData();
      displayTagList();
      displayTagFilters();

      document.getElementById('new-tag-name').value = '';
      document.getElementById('new-tag-color').value = '#6b2d8f';
    }

    // Copy selected
    function copySelectedComments() {
      if (selectedComments.size === 0) {
        const btn = document.getElementById('copySelectedBtn');
        btn.textContent = '‚àÖ';
        setTimeout(() => btn.textContent = 'üìã', 800);
        return;
      }

      const bank = commentBanks[currentCommentBankIndex];
      const texts = Array.from(selectedComments)
        .map(index => {
          const card = bank.comments[index];
          if (!card) return '';
          let text = card.title || '';
          if (card.link) text += `\n${card.link}`;
          if (card.description) text += `\n${card.description}`;
          return text;
        })
        .filter(t => t);

      navigator.clipboard.writeText(texts.join('\n\n')).then(() => {
        const btn = document.getElementById('copySelectedBtn');
        btn.textContent = '‚úì';
        setTimeout(() => {
          btn.textContent = texts.length.toString();
          setTimeout(() => btn.textContent = 'üìã', 800);
        }, 400);
      });
    }

    // Download/Upload
    function showDownloadPopup() {
      const container = document.getElementById('download-options');
      container.innerHTML = '';

      if (commentBanks.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #888;">No drawers to download</p>';
      } else {
        commentBanks.forEach((bank, index) => {
          const option = document.createElement('div');
          option.style.padding = '8px';
          option.style.marginBottom = '4px';
          option.style.background = '#f5f5f5';
          option.style.borderRadius = '6px';
          option.style.cursor = 'pointer';
          option.textContent = bank.assignmentName;
          option.onclick = () => downloadDrawer(index);
          container.appendChild(option);
        });
      }

      document.getElementById('download-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function downloadDrawer(index) {
      const bank = commentBanks[index];
      const json = JSON.stringify(bank, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${bank.assignmentName.replace(/[^a-z0-9]/gi, '_')}.drawer`;
      a.click();
      URL.revokeObjectURL(url);
      hideDownloadPopup();
    }

    function uploadDrawer() {
      const input = document.getElementById('upload-input');
      const file = input.files[0];

      if (!file) {
        alert('Please select a file');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          commentBanks.push(data);
          saveData();
          updateCommentBankList();
          hideUploadPopup();
          input.value = '';
        } catch (err) {
          alert('Invalid file format');
        }
      };
      reader.readAsText(file);
    }

    // Modal controls
    function showPopup() {
      document.getElementById('popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('assignment-name').focus();
    }

    function hidePopup() {
      document.getElementById('popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function showAddCommentPopup() {
      document.getElementById('add-comment-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function hideAddCommentPopup() {
      document.getElementById('add-comment-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function hideDownloadPopup() {
      document.getElementById('download-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function hideUploadPopup() {
      document.getElementById('upload-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function hideTagManager() {
      document.getElementById('tag-manager-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function hideAbout() {
      document.getElementById('about-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function showAbout() {
      document.getElementById('about-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    // Event listeners
    document.getElementById('addCommentBankBtn').onclick = showPopup;
    document.getElementById('cancelBankBtn').onclick = hidePopup;
    document.getElementById('createBankBtn').onclick = () => {
      const name = document.getElementById('assignment-name').value.trim();
      if (!name) {
        alert('Please enter a drawer name');
        return;
      }

      if (commentBanks.some(b => b.assignmentName.toLowerCase() === name.toLowerCase())) {
        alert('A drawer with this name already exists');
        return;
      }

      commentBanks.push({
        assignmentName: name,
        comments: [],
        tags: getBasicTags(),
        archived: false
      });

      saveData();
      updateCommentBankList();
      document.getElementById('assignment-name').value = '';
      hidePopup();
    };

    document.getElementById('backToHomeBtn').onclick = goToHome;
    document.getElementById('addCommentBtn').onclick = addComment;
    document.getElementById('saveCommentBtn').onclick = saveComment;
    document.getElementById('cancelCommentBtn').onclick = hideAddCommentPopup;
    document.getElementById('manageTagsBtn').onclick = showTagManager;
    document.getElementById('doneTagsBtn').onclick = hideTagManager;
    document.getElementById('addTagBtn').onclick = addTag;
    document.getElementById('copySelectedBtn').onclick = copySelectedComments;

    document.getElementById('optionsDropdownBtn').onclick = () => {
      document.getElementById('optionsDropdownMenu').classList.toggle('show');
    };

    document.getElementById('aboutBtn').onclick = () => {
      document.getElementById('optionsDropdownMenu').classList.remove('show');
      showAbout();
    };

    document.getElementById('closeAboutBtn').onclick = hideAbout;

    document.getElementById('downloadBtn').onclick = () => {
      document.getElementById('optionsDropdownMenu').classList.remove('show');
      showDownloadPopup();
    };

    document.getElementById('cancelDownloadBtn').onclick = hideDownloadPopup;

    document.getElementById('uploadBtn').onclick = () => {
      document.getElementById('optionsDropdownMenu').classList.remove('show');
      document.getElementById('upload-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    };

    document.getElementById('uploadConfirmBtn').onclick = uploadDrawer;
    document.getElementById('cancelUploadBtn').onclick = hideUploadPopup;

    document.getElementById('resetBtn').onclick = () => {
      document.getElementById('optionsDropdownMenu').classList.remove('show');
      document.getElementById('clear-data-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    };

    document.getElementById('yesClearBtn').onclick = () => {
      commentBanks = [];
      saveData();
      updateCommentBankList();
      goToHome();
      document.getElementById('clear-data-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    };

    document.getElementById('noClearBtn').onclick = () => {
      document.getElementById('clear-data-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    };

    document.getElementById('toggle-filters-btn').onclick = () => {
      document.getElementById('tag-filters').classList.toggle('hidden');
    };

    document.getElementById('clear-filters-btn').onclick = () => {
      activeTagFilters = [];
      const bank = commentBanks[currentCommentBankIndex];
      displayTagFilters();
      displayComments(bank.comments);
    };

    document.getElementById('comment-search').oninput = (e) => {
      searchQuery = e.target.value.trim().toLowerCase();
      const bank = commentBanks[currentCommentBankIndex];
      displayComments(bank.comments);

      const clearBtn = document.getElementById('comment-search-clear');
      clearBtn.style.display = searchQuery ? 'block' : 'none';
    };

    document.getElementById('comment-search-clear').onclick = () => {
      document.getElementById('comment-search').value = '';
      searchQuery = '';
      const bank = commentBanks[currentCommentBankIndex];
      displayComments(bank.comments);
      document.getElementById('comment-search-clear').style.display = 'none';
    };

    document.getElementById('drawer-search').oninput = (e) => {
      updateCommentBankList();
      const clearBtn = document.getElementById('drawer-search-clear');
      clearBtn.style.display = e.target.value ? 'block' : 'none';
    };

    document.getElementById('drawer-search-clear').onclick = () => {
      document.getElementById('drawer-search').value = '';
      updateCommentBankList();
      document.getElementById('drawer-search-clear').style.display = 'none';
    };

    // Close overlay
    document.getElementById('overlay').onclick = () => {
      hidePopup();
      hideAddCommentPopup();
      hideDownloadPopup();
      hideUploadPopup();
      hideTagManager();
      hideAbout();
      document.getElementById('clear-data-popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('optionsDropdownMenu').classList.remove('show');
    };

    // Close dropdown when clicking outside
    window.onclick = (e) => {
      if (!e.target.matches('.toggle-btn')) {
        const dropdown = document.getElementById('optionsDropdownMenu');
        if (dropdown.classList.contains('show')) {
          dropdown.classList.remove('show');
        }
      }
    };

    // Enter key for new drawer
    document.getElementById('assignment-name').onkeypress = (e) => {
      if (e.key === 'Enter') {
        document.getElementById('createBankBtn').click();
      }
    };

    // Initialize
    loadData();
  </script>
</body>
</html>
